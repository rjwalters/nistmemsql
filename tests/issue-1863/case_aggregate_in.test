# Issue #1863: IN/NOT IN operators return incorrect boolean values when CASE expression with aggregates returns NULL
#
# This test file verifies that CASE expressions containing aggregates return NULL correctly
# when used in IN/NOT IN predicates, per SQL three-valued logic semantics.

# Test 1 (Baseline): CASE with aggregate returns NULL - should PASS (already works)
query I
SELECT (CASE -COUNT(*) WHEN -10 THEN 1 END);
----
NULL

# Test 2 (NOT IN bug): CASE with aggregate in NOT IN returns NULL - currently FAILS
query I
SELECT (CASE -COUNT(*) WHEN -10 THEN 1 END) NOT IN (32);
----
NULL

# Test 3 (IN bug): CASE with aggregate in IN returns NULL - currently FAILS
query I
SELECT (CASE -COUNT(*) WHEN -10 THEN 1 END) IN (32);
----
NULL

# Test 4 (Workaround verification): Subquery wrapper still works - should PASS
query I
SELECT (SELECT CASE -COUNT(*) WHEN -10 THEN 1 END) NOT IN (32);
----
NULL

# Test 5 (Edge case - NULL matches): CASE NULL in list containing NULL
query I
SELECT (CASE -COUNT(*) WHEN -10 THEN 1 END) IN (32, NULL);
----
NULL

# Test 6 (Without unary operator): CASE without negation
query I
SELECT (CASE COUNT(*) WHEN 10 THEN 1 END) NOT IN (32);
----
NULL

# Test 7 (Different aggregate with table data): Other aggregate functions
statement ok
CREATE TABLE test_table (x INTEGER);

statement ok
INSERT INTO test_table VALUES (5), (10), (15);

query I
SELECT (CASE SUM(x) WHEN 999 THEN 1 END) IN (5) FROM test_table;
----
NULL

# Test 8 (Searched CASE): CASE without operand, with aggregate in condition
query I
SELECT (CASE WHEN COUNT(*) = 10 THEN 1 END) NOT IN (32);
----
NULL

# Cleanup
statement ok
DROP TABLE test_table;
