# Test for slow nested IN subquery performance issue
# This query takes 97-109 seconds on tab0 with 1000 rows

statement ok
CREATE TABLE tab0(pk INTEGER PRIMARY KEY, col0 INTEGER, col1 DECIMAL(12,2), col3 INTEGER, col4 DECIMAL(12,2))

statement ok
CREATE INDEX idx_tab0_col0 ON tab0 (col0)

statement ok
CREATE INDEX idx_tab0_col1 ON tab0 (col1)

statement ok
CREATE INDEX idx_tab0_col3 ON tab0 (col3)

statement ok
CREATE INDEX idx_tab0_col4 ON tab0 (col4)

# Insert 50 rows manually for testing
statement ok
INSERT INTO tab0 VALUES
(0, 0, 0.0, 0, 0.0),
(1, 10, 1.5, 3, 2.5),
(2, 20, 3.0, 6, 5.0),
(3, 30, 4.5, 9, 7.5),
(4, 40, 6.0, 12, 10.0),
(5, 50, 7.5, 15, 12.5),
(6, 60, 9.0, 18, 15.0),
(7, 70, 10.5, 21, 17.5),
(8, 80, 12.0, 24, 20.0),
(9, 90, 13.5, 27, 22.5),
(10, 100, 15.0, 30, 25.0),
(11, 110, 16.5, 33, 27.5),
(12, 120, 18.0, 36, 30.0),
(13, 130, 19.5, 39, 32.5),
(14, 140, 21.0, 42, 35.0),
(15, 150, 22.5, 45, 37.5),
(16, 160, 24.0, 48, 40.0),
(17, 170, 25.5, 51, 42.5),
(18, 180, 27.0, 54, 45.0),
(19, 190, 28.5, 57, 47.5),
(20, 200, 30.0, 60, 50.0),
(21, 210, 31.5, 63, 52.5),
(22, 220, 33.0, 66, 55.0),
(23, 230, 34.5, 69, 57.5),
(24, 240, 36.0, 72, 60.0),
(25, 250, 37.5, 75, 62.5),
(26, 260, 39.0, 78, 65.0),
(27, 270, 40.5, 81, 67.5),
(28, 280, 42.0, 84, 70.0),
(29, 290, 43.5, 87, 72.5),
(30, 300, 45.0, 90, 75.0),
(31, 310, 46.5, 93, 77.5),
(32, 320, 48.0, 96, 80.0),
(33, 330, 49.5, 99, 82.5),
(34, 340, 51.0, 102, 85.0),
(35, 350, 52.5, 105, 87.5),
(36, 360, 54.0, 108, 90.0),
(37, 370, 55.5, 111, 92.5),
(38, 380, 57.0, 114, 95.0),
(39, 390, 58.5, 117, 97.5),
(40, 400, 60.0, 120, 100.0),
(41, 410, 61.5, 123, 102.5),
(42, 420, 63.0, 126, 105.0),
(43, 430, 64.5, 129, 107.5),
(44, 440, 66.0, 132, 110.0),
(45, 450, 67.5, 135, 112.5),
(46, 460, 69.0, 138, 115.0),
(47, 470, 70.5, 141, 117.5),
(48, 480, 72.0, 144, 120.0),
(49, 490, 73.5, 147, 122.5)

# First test the innermost subquery
query I rowsort
SELECT col0 FROM tab0 WHERE col4 = 97.5
----
390

# Then test the middle subquery
query I rowsort
SELECT col0 FROM tab0
WHERE col1 >= 68.0
  AND col3 IN (SELECT col0 FROM tab0 WHERE col4 = 97.5)
----

# Finally test the full nested IN subquery
query I rowsort
SELECT pk FROM tab0
WHERE col0 > 23
  AND col3 IN (
    SELECT col0 FROM tab0
    WHERE col1 >= 68.0
      AND col3 IN (
        SELECT col0 FROM tab0
        WHERE col4 = 97.5
      )
  )
----

