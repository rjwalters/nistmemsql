# Test for issue #1838: WHERE clause on indexed column + ORDER BY losing rows
# This test ensures that when using an indexed WHERE clause with ORDER BY,
# all matching rows are returned (no double filtering)

statement ok
CREATE TABLE tab1 (
    pk INTEGER PRIMARY KEY,
    col1 INTEGER,
    col2 INTEGER,
    col3 INTEGER
)

statement ok
CREATE INDEX idx_col3 ON tab1(col3)

# Insert test data - 8 rows where col3 > 221
statement ok
INSERT INTO tab1 VALUES (1, 100, 200, 300)

statement ok
INSERT INTO tab1 VALUES (2, 110, 210, 310)

statement ok
INSERT INTO tab1 VALUES (3, 120, 220, 222)

statement ok
INSERT INTO tab1 VALUES (4, 130, 230, 232)

statement ok
INSERT INTO tab1 VALUES (5, 140, 240, 242)

statement ok
INSERT INTO tab1 VALUES (6, 150, 250, 252)

statement ok
INSERT INTO tab1 VALUES (7, 160, 260, 262)

statement ok
INSERT INTO tab1 VALUES (8, 170, 270, 272)

statement ok
INSERT INTO tab1 VALUES (9, 180, 280, 100)

statement ok
INSERT INTO tab1 VALUES (10, 190, 290, 110)

# The bug: This query was losing row with pk=2 (col3=310)
# Expected: 8 rows (pk=1,2,3,4,5,6,7,8 all have col3 > 221)
# Bug behavior: returned 7 rows (missing pk=2)
query I
SELECT pk FROM tab1 WHERE col3 > 221 ORDER BY pk DESC
----
8
7
6
5
4
3
2
1

# Verify the same query without ORDER BY also returns correct count
query I
SELECT COUNT(*) FROM tab1 WHERE col3 > 221
----
8

# Test ascending order as well
query I
SELECT pk FROM tab1 WHERE col3 > 221 ORDER BY pk ASC
----
1
2
3
4
5
6
7
8

# Test with different comparison operators
query I
SELECT pk FROM tab1 WHERE col3 >= 300 ORDER BY pk
----
1
2

query I
SELECT pk FROM tab1 WHERE col3 < 250 ORDER BY pk DESC
----
5
4
3

# Test without ORDER BY to ensure basic WHERE works
query I
SELECT pk FROM tab1 WHERE col3 > 221 ORDER BY col3
----
3
4
5
6
7
8
1
2
